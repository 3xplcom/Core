<?php declare(strict_types = 1);

/*  Idea (c) 2023 Nikita Zhavoronkov, nikzh@nikzh.com
 *  Copyright (c) 2023-2024 3xpl developers, 3@3xpl.com, see CONTRIBUTORS.md
 *  Distributed under the MIT software license, see LICENSE.md  */

/*  This is the main Mantle module. It requires a geth node to run.  */

final class MantleMainModule extends EVMMainModule implements Module, BalanceSpecial, TransactionSpecials, AddressSpecials
{
    function initialize()
    {
        // CoreModule
        $this->blockchain = 'mantle';
        $this->module = 'mantle-main';
        $this->is_main = true;
        $this->first_block_date = '2023-07-02';
        $this->first_block_id = 0;
        $this->currency = 'mantle';
        $this->currency_details = ['name' => 'Mantle', 'symbol' => 'MNT', 'decimals' => 18, 'description' => null];
        $this->mempool_implemented = false;

        // EVMMainModule
        $this->evm_implementation = EVMImplementation::geth;
        $this->extra_features = [EVMSpecialFeatures::HasSystemTransactions, EVMSpecialFeatures::OPStackBaseFeeRecipient]; // Mantle is a fork of Optimism, so it has the same special txs
        $this->reward_function = function($block_id)
        {
            return '0';
        };
        $this->base_fee_recipient = '0x4200000000000000000000000000000000000019';

        $this->tests = [
            ['block' => 66807079, 'result' => 'a:2:{s:6:"events";a:36:{i:0;a:8:{s:11:"transaction";s:66:"0xf19eeed68c195540afa4888137567d43f669860050c3de58b0ef28436cd258d0";s:7:"address";s:42:"0xdeaddeaddeaddeaddeaddeaddeaddeaddead0001";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:0;}i:1;a:8:{s:11:"transaction";s:66:"0xf19eeed68c195540afa4888137567d43f669860050c3de58b0ef28436cd258d0";s:7:"address";s:42:"0x4200000000000000000000000000000000000015";s:6:"effect";s:1:"0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:1;}i:2;a:8:{s:11:"transaction";s:66:"0x199a31e6992f18b303e97a1b65bc28efdb6b8716e52911ad3049a32540bc1fb5";s:7:"address";s:42:"0x510bcad5157c26d38276b769165579ab02fdff41";s:6:"effect";s:19:"-150961830120000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"b";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:2;}i:3;a:8:{s:11:"transaction";s:66:"0x199a31e6992f18b303e97a1b65bc28efdb6b8716e52911ad3049a32540bc1fb5";s:7:"address";s:42:"0x4200000000000000000000000000000000000019";s:6:"effect";s:18:"150961830120000000";s:6:"failed";s:1:"f";s:5:"extra";s:2:"fb";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:3;}i:4;a:8:{s:11:"transaction";s:66:"0x199a31e6992f18b303e97a1b65bc28efdb6b8716e52911ad3049a32540bc1fb5";s:7:"address";s:42:"0x510bcad5157c26d38276b769165579ab02fdff41";s:6:"effect";s:18:"-18870228765000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"f";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:4;}i:5;a:8:{s:11:"transaction";s:66:"0x199a31e6992f18b303e97a1b65bc28efdb6b8716e52911ad3049a32540bc1fb5";s:7:"address";s:42:"0x4200000000000000000000000000000000000011";s:6:"effect";s:17:"18870228765000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"f";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:5;}i:6;a:8:{s:11:"transaction";s:66:"0x199a31e6992f18b303e97a1b65bc28efdb6b8716e52911ad3049a32540bc1fb5";s:7:"address";s:42:"0x510bcad5157c26d38276b769165579ab02fdff41";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"t";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:6;}i:7;a:8:{s:11:"transaction";s:66:"0x199a31e6992f18b303e97a1b65bc28efdb6b8716e52911ad3049a32540bc1fb5";s:7:"address";s:42:"0xd9f4e85489adcd0baf0cd63b4231c6af58c26745";s:6:"effect";s:1:"0";s:6:"failed";s:1:"t";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:7;}i:8;a:8:{s:11:"transaction";s:66:"0x55327403b9e3293bfb34ee09043906fe828a14692d2e57dbcccf73fc418a9701";s:7:"address";s:42:"0x622372558a8d49a227938f7cd2b5c581a042964e";s:6:"effect";s:17:"-4481994820000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"b";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:8;}i:9;a:8:{s:11:"transaction";s:66:"0x55327403b9e3293bfb34ee09043906fe828a14692d2e57dbcccf73fc418a9701";s:7:"address";s:42:"0x4200000000000000000000000000000000000019";s:6:"effect";s:16:"4481994820000000";s:6:"failed";s:1:"f";s:5:"extra";s:2:"fb";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:9;}i:10;a:8:{s:11:"transaction";s:66:"0x55327403b9e3293bfb34ee09043906fe828a14692d2e57dbcccf73fc418a9701";s:7:"address";s:42:"0x622372558a8d49a227938f7cd2b5c581a042964e";s:6:"effect";s:10:"-224099741";s:6:"failed";s:1:"f";s:5:"extra";s:1:"f";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:10;}i:11;a:8:{s:11:"transaction";s:66:"0x55327403b9e3293bfb34ee09043906fe828a14692d2e57dbcccf73fc418a9701";s:7:"address";s:42:"0x4200000000000000000000000000000000000011";s:6:"effect";s:9:"224099741";s:6:"failed";s:1:"f";s:5:"extra";s:1:"f";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:11;}i:12;a:8:{s:11:"transaction";s:66:"0x55327403b9e3293bfb34ee09043906fe828a14692d2e57dbcccf73fc418a9701";s:7:"address";s:42:"0x622372558a8d49a227938f7cd2b5c581a042964e";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:12;}i:13;a:8:{s:11:"transaction";s:66:"0x55327403b9e3293bfb34ee09043906fe828a14692d2e57dbcccf73fc418a9701";s:7:"address";s:42:"0xdeaddeaddeaddeaddeaddeaddeaddeaddead1111";s:6:"effect";s:1:"0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:13;}i:14;a:8:{s:11:"transaction";s:66:"0xca7b6e2081063f0c97de46dd4be3ab1f259a8d9f393795a220607c66f9eb3e47";s:7:"address";s:42:"0x29161e1463e72a326abaed44cdcc1a0356371fb8";s:6:"effect";s:18:"-10492745820000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"b";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:14;}i:15;a:8:{s:11:"transaction";s:66:"0xca7b6e2081063f0c97de46dd4be3ab1f259a8d9f393795a220607c66f9eb3e47";s:7:"address";s:42:"0x4200000000000000000000000000000000000019";s:6:"effect";s:17:"10492745820000000";s:6:"failed";s:1:"f";s:5:"extra";s:2:"fb";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:15;}i:16;a:8:{s:11:"transaction";s:66:"0xca7b6e2081063f0c97de46dd4be3ab1f259a8d9f393795a220607c66f9eb3e47";s:7:"address";s:42:"0x29161e1463e72a326abaed44cdcc1a0356371fb8";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:16;}i:17;a:8:{s:11:"transaction";s:66:"0xca7b6e2081063f0c97de46dd4be3ab1f259a8d9f393795a220607c66f9eb3e47";s:7:"address";s:42:"0x319b69888b0d11cec22caa5034e25fffbdc88421";s:6:"effect";s:1:"0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:17;}i:18;a:8:{s:11:"transaction";s:66:"0xda2510f4b403132bc7ea639923c1459e56d5947b57609ca5bacc45ea67b517f9";s:7:"address";s:42:"0xa2ecde0438e57fa38879c43ef9af84e2a2926ddd";s:6:"effect";s:17:"-2311792600000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"b";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:18;}i:19;a:8:{s:11:"transaction";s:66:"0xda2510f4b403132bc7ea639923c1459e56d5947b57609ca5bacc45ea67b517f9";s:7:"address";s:42:"0x4200000000000000000000000000000000000019";s:6:"effect";s:16:"2311792600000000";s:6:"failed";s:1:"f";s:5:"extra";s:2:"fb";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:19;}i:20;a:8:{s:11:"transaction";s:66:"0xda2510f4b403132bc7ea639923c1459e56d5947b57609ca5bacc45ea67b517f9";s:7:"address";s:42:"0xa2ecde0438e57fa38879c43ef9af84e2a2926ddd";s:6:"effect";s:20:"-2419522519348742720";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:20;}i:21;a:8:{s:11:"transaction";s:66:"0xda2510f4b403132bc7ea639923c1459e56d5947b57609ca5bacc45ea67b517f9";s:7:"address";s:42:"0x08017b9a812eb286e5b63a9cc873c9e2d3464ac5";s:6:"effect";s:19:"2419522519348742720";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:21;}i:22;a:8:{s:11:"transaction";s:66:"0xf8675aaf1293d2bb0b3f8ffed5185437fcf5fe5680392e2c468c0c49e39a1745";s:7:"address";s:42:"0x8b06c0a45791064bf2d4f4e87559691d4ec39725";s:6:"effect";s:18:"-10492745820000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"b";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:22;}i:23;a:8:{s:11:"transaction";s:66:"0xf8675aaf1293d2bb0b3f8ffed5185437fcf5fe5680392e2c468c0c49e39a1745";s:7:"address";s:42:"0x4200000000000000000000000000000000000019";s:6:"effect";s:17:"10492745820000000";s:6:"failed";s:1:"f";s:5:"extra";s:2:"fb";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:23;}i:24;a:8:{s:11:"transaction";s:66:"0xf8675aaf1293d2bb0b3f8ffed5185437fcf5fe5680392e2c468c0c49e39a1745";s:7:"address";s:42:"0x8b06c0a45791064bf2d4f4e87559691d4ec39725";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:24;}i:25;a:8:{s:11:"transaction";s:66:"0xf8675aaf1293d2bb0b3f8ffed5185437fcf5fe5680392e2c468c0c49e39a1745";s:7:"address";s:42:"0x319b69888b0d11cec22caa5034e25fffbdc88421";s:6:"effect";s:1:"0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:25;}i:26;a:8:{s:11:"transaction";s:66:"0x5924bb978b10140c9789da5d7a3c63790dd3530c7c2b852495fd4bb6cfc39599";s:7:"address";s:42:"0x41621b2e924a3746ab6ec90bfbf3835e2a71648a";s:6:"effect";s:18:"-12540229620000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"b";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:26;}i:27;a:8:{s:11:"transaction";s:66:"0x5924bb978b10140c9789da5d7a3c63790dd3530c7c2b852495fd4bb6cfc39599";s:7:"address";s:42:"0x4200000000000000000000000000000000000019";s:6:"effect";s:17:"12540229620000000";s:6:"failed";s:1:"f";s:5:"extra";s:2:"fb";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:27;}i:28;a:8:{s:11:"transaction";s:66:"0x5924bb978b10140c9789da5d7a3c63790dd3530c7c2b852495fd4bb6cfc39599";s:7:"address";s:42:"0x41621b2e924a3746ab6ec90bfbf3835e2a71648a";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:28;}i:29;a:8:{s:11:"transaction";s:66:"0x5924bb978b10140c9789da5d7a3c63790dd3530c7c2b852495fd4bb6cfc39599";s:7:"address";s:42:"0x5989fb161568b9f133edf5cf6787f5597762797f";s:6:"effect";s:1:"0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:29;}i:30;a:8:{s:11:"transaction";s:66:"0x9d3bf485c6fb13b3980cb1706c40f5ce741edc4b08e0830cf067149a5080420c";s:7:"address";s:42:"0x08fdf9fc4a6eb2a28007d82ae2d9fa4ac29ffa7a";s:6:"effect";s:18:"-11021880480000000";s:6:"failed";s:1:"f";s:5:"extra";s:1:"b";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:30;}i:31;a:8:{s:11:"transaction";s:66:"0x9d3bf485c6fb13b3980cb1706c40f5ce741edc4b08e0830cf067149a5080420c";s:7:"address";s:42:"0x4200000000000000000000000000000000000019";s:6:"effect";s:17:"11021880480000000";s:6:"failed";s:1:"f";s:5:"extra";s:2:"fb";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:31;}i:32;a:8:{s:11:"transaction";s:66:"0x9d3bf485c6fb13b3980cb1706c40f5ce741edc4b08e0830cf067149a5080420c";s:7:"address";s:42:"0x08fdf9fc4a6eb2a28007d82ae2d9fa4ac29ffa7a";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:32;}i:33;a:8:{s:11:"transaction";s:66:"0x9d3bf485c6fb13b3980cb1706c40f5ce741edc4b08e0830cf067149a5080420c";s:7:"address";s:42:"0xeaee7ee68874218c3558b40063c42b82d3e7232a";s:6:"effect";s:1:"0";s:6:"failed";s:1:"f";s:5:"extra";N;s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:33;}i:34;a:8:{s:11:"transaction";N;s:7:"address";s:4:"0x00";s:6:"effect";s:2:"-0";s:6:"failed";s:1:"f";s:5:"extra";s:1:"r";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:34;}i:35;a:8:{s:11:"transaction";N;s:7:"address";s:42:"0x4200000000000000000000000000000000000011";s:6:"effect";s:1:"0";s:6:"failed";s:1:"f";s:5:"extra";s:1:"r";s:5:"block";i:66807079;s:4:"time";s:19:"2024-07-23 14:21:10";s:8:"sort_key";i:35;}}s:10:"currencies";N;}'],
        ];
    }
}
